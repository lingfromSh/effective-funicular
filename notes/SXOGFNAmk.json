{"_id":"note:SXOGFNAmk","title":"Nginx 支持Websocket","content":"# Nginx 支持websocket\n\n## nginx.conf\n```nginx\nhttp {\n    map $http_upgrade $connection_upgrade {\n        default upgrade;\n        '' close;\n    }\n    \n    /* \n    map指令的作用：\n    该作用主要是根据客户端请求中$http_upgrade 的值，来构造改变$connection_upgrade的值，即根据变量$http_upgrade的值创建新的变量$connection_upgrade，\n    创建的规则就是{}里面的东西。其中的规则没有做匹配，因此使用默认的，即 $connection_upgrade 的值会一直是 upgrade。然后如果 $http_upgrade为空字符串的话，\n    那值会是 close。\n    */        \n        \n    location {\n        proxy_pass http://serverhost.com;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host:$server_port;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"Upgrade\";\n    }\n}\n```","tags":[],"folderPathname":"/开发","data":{},"createdAt":"2020-12-08T14:30:53.221Z","updatedAt":"2020-12-08T14:38:03.078Z","trashed":false,"_rev":"jtOfiMESP"}